{% extends 'base.html' %}
{% load widget_tweaks %}
{% load static %}
{% block extra_headers %}
    <script src="{% static 'ligand_service/reactive.js' %}"> </script>
    <script src="{% static 'resumable.js' %}"> </script>
{% endblock %}
{% block content %}
    <details open
             class="my-4 text-l rounded-lg border p-2 bg-gray-300 cursor-pointer">
        <summary class="text-2xl">How to use CORAL-MD?</summary>
        This tool processes molecular dynamics (MD) trajectories to examine how ligands interact with their protein targets. It identifies and characterizes interaction types such as hydrogen bonds, hydrophobic contacts, and aromatic stacking, and presents the results through time-resolved visualizations. Users can also choose to provide experimental data, allowing direct comparison between simulation outcomes and measured values. An example of the tool in action can be seen using <a href="/example-submission"
    class="text-blue-700 underline-offset-2 underline">this link</a>.
        <br>
        <br>
        For technical details, go to the About section.
    </p>
</details>
<div class="border rounded-lg p-2 min-w-0">
    <h2 class="mb-4 text-2xl border-b -m-2 rounded-t-lg p-2 bg-gray-300">Submit your job:</h2>
    <form id="input-form"
          action="/submit/form"
          method="post"
          enctype="multipart/form-data">
        <div id="file-table" class="flex flex-col min-w-0 items-start">
            {{ formset.management_form }}
            {% for form in formset %}{{ form }}{% endfor %}
            <div id="add-more-btn"
                 class="border rounded-lg w-fit h-fit my-2 bg-gray-300 hover:bg-gray-400/70">
                <button type="button" onclick="addFiles()" class="m-1 p-2 cursor-pointer">Add additional files</button>
            </div>
            <div id="file-input-template" class="hidden">{{ formset.empty_form }}</div>
        </div>
        <button type="submit"
                class="bg-green-300 hover:bg-green-400 border rounded-lg p-2 cursor-pointer ">Submit</button>
        <button type="reset"
                class="bg-red-300 hover:bg-red-400 border rounded-lg p-2 cursor-pointer ">Reset</button>
        <div id="progress-bar-container"
             class="invisible inline-flex items-center gap-2 rounded-lg border p-2">
            <label for="progress-bar">Submission progress:</label>
            <progress id="progress-bar"
                      max="100"
                      value="0"
                      class="bg-gray-300 border align-middle"></progress>
            <p id="progress-bar-counter">0%</p>
        </div>
        <div class="grid grid-cols-2 mt-2 w-fit">
            <label class="p-2 rounded-lg border bg-gray-300 hover:bg-gray-400/70 hover:backdrop-opacity-0 cursor-pointer m-1 ml-0 items-center">
                {% render_field details_form.add_VOI class="" onchange="toggleExperimentalValues()" %}
                Add experimental values
            </label>
            <label class="p-2 rounded-lg border bg-gray-300 hover:bg-gray-400/70 cursor-pointer m-1 ml-0 items-center">
                {% render_field details_form.compare_by_residue class="text-xl" %}
                Compare by residue number
            </label>
            <label class="border rounded-lg p-2 m-1 ml-0 items-center">
                Email when finished:
                {% render_field details_form.email class="bg-gray-300 border rounded-sm" %}
            </label>
        </div>
        <p class="my-2">NOTE: By default, to compare different receptors/structures we use GPCRdb's numbering.</p>
    </form>
</div>
<p class="mt-2 text-xl">Please cite as...(TBD)</p>
<button class="text-xl border rounded-lg p-2 bg-red-400 hover:bg-red-200 mt-1 hover:cursor-pointer"
        onclick="downloadLogs(event, 'webserver.log')">Download webserver logs</button>
<button class="text-xl border rounded-lg p-2 bg-red-400 hover:bg-red-200 mt-1 hover:cursor-pointer"
        onclick="downloadLogs(event, 'huey.log')">Download huey logs</button>
<button class="text-xl border rounded-lg p-2 bg-red-400 hover:bg-red-200 mt-1 hover:cursor-pointer"
        onclick="downloadLogs(event, 'huey_cli.log')">Download huey cli logs</button>
<div class="border w-fit p-2 flex flex-nowrap">
    <span id="browseButton" class="cursor-pointer bg-amber-500 p-2">Browse...</span>
    <span id="filesInfo" class="bg-amber-300 p-2" onclick="">Selected files:</span>
    <span id="sendButton"
          class="cursor-pointer bg-amber-500 p-2"
          onclick="uploadThis(0)">Send</span>
    <p id="uploadStatus" class="invisible cursor-pointer bg-amber-500 p-2">0</p>
</div>
{% endblock %}
